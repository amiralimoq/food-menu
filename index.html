<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ÙˆÛŒ Ø±Ø³ØªÙˆØ±Ø§Ù†</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Tahoma, sans-serif; background: #f5f5f5; padding: 20px; color: #333; }
        .card { background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .btn { background: #3390ec; color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        .btn-remove { background: #e53935; }
        #order-btn { width: 100%; padding: 15px; background: #2ecc71; color: white; border: none; font-size: 16px; border-radius: 10px; margin-top: 20px; display: none; }
    </style>
</head>
<body>

    <h2>ğŸ” Ù…Ù†ÙˆÛŒ Ø§Ù…Ø±ÙˆØ²</h2>
    <div id="menu-list"></div>
    <button id="order-btn" onclick="sendOrder()">ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // ØªÙ…Ø§Ù… ØµÙØ­Ù‡ Ú©Ø±Ø¯Ù† Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„

        // 1. Ù„ÛŒØ³Øª ØºØ°Ø§Ù‡Ø§ (Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø³Ø§Ø¯Ù‡ Ø´Ù…Ø§)
        const menu = [
            { id: 1, name: "Ù¾ÛŒØªØ²Ø§ Ù…Ø®ØµÙˆØµ", price: 250000 },
            { id: 2, name: "Ù‡Ù…Ø¨Ø±Ú¯Ø± Ø°ØºØ§Ù„ÛŒ", price: 180000 },
            { id: 3, name: "Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ Ø³Ø±Ø®â€ŒÚ©Ø±Ø¯Ù‡", price: 90000 },
            { id: 4, name: "Ù†ÙˆØ´Ø§Ø¨Ù‡ Ù‚ÙˆØ·ÛŒ", price: 30000 }
        ];

        let cart = {};

        // 2. Ù†Ù…Ø§ÛŒØ´ Ù…Ù†Ùˆ Ø¯Ø± ØµÙØ­Ù‡
        const menuContainer = document.getElementById('menu-list');
        menu.forEach(item => {
            const el = document.createElement('div');
            el.className = 'card';
            el.innerHTML = 
                <div>
                    <b>${item.name}</b><br>
                    <small>${item.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</small>
                </div>
                <button class="btn" onclick="addToCart(${item.id})">Ø§ÙØ²ÙˆØ¯Ù†</button>
            ;
            menuContainer.appendChild(el);
        });

        // 3. Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯
        function addToCart(id) {
            if (!cart[id]) cart[id] = 0;
            cart[id]++;
            document.getElementById('order-btn').style.display = 'block';
            document.getElementById('order-btn').innerText = Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ (ØªØ¹Ø¯Ø§Ø¯: ${Object.values(cart).reduce((a,b)=>a+b, 0)});
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… (MainButton)
            tg.MainButton.setText("ØªØ§ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø³ÙØ§Ø±Ø´");
            tg.MainButton.show();
        }

        // 4. Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù‡ Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…
        // Ù‡Ù… Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ø®Ù„ ØµÙØ­Ù‡ Ùˆ Ù‡Ù… Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        tg.MainButton.onClick(() => sendOrder());

        function sendOrder() {
            const orderDetails = {
                items: cart,
                total_price: calculateTotal()
            };
            // Ø§ÛŒÙ† Ø®Ø· Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…ÛŒâ€ŒÙØ±Ø³ØªØ¯
            tg.sendData(JSON.stringify(orderDetails)); 
        }

        function calculateTotal() {
            let total = 0;
            for (const [id, count] of Object.entries(cart)) {
                const item = menu.find(i => i.id == id);
                total += item.price * count;
            }
            return total;
        }
    </script>
</body>
</html>